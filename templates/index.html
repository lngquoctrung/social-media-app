<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1.0"
        />
        <title>Social App - Login</title>
        <link
            rel="stylesheet"
            href="style.css"
        />
    </head>
    <body>
        <div class="container">
            <h2 id="form-title">Login</h2>
            <div
                id="auth-message"
                style="color: red; margin-bottom: 10px"
            ></div>

            <form id="auth-form">
                <div
                    class="form-group"
                    id="name-group"
                    style="display: none"
                >
                    <label>Name</label>
                    <input
                        type="text"
                        id="name"
                        placeholder="Full Name"
                    />
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input
                        type="email"
                        id="email"
                        required
                        placeholder="Email"
                    />
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input
                        type="password"
                        id="password"
                        required
                        placeholder="Password"
                    />
                </div>
                <div
                    class="form-group"
                    id="birthday-group"
                    style="display: none"
                >
                    <label>Birthday</label>
                    <input
                        type="date"
                        id="birthday"
                    />
                </div>
                <div
                    class="form-group"
                    id="gender-group"
                    style="display: none"
                >
                    <label>Gender</label>
                    <select id="gender">
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                        <option value="other">Other</option>
                    </select>
                </div>

                <button
                    type="submit"
                    id="submit-btn"
                >
                    Login
                </button>
            </form>

            <p style="text-align: center; margin-top: 15px">
                <a
                    href="#"
                    id="toggle-mode"
                    >Don't have an account? Sign Up</a
                >
            </p>
        </div>

        <script src="app.js"></script>
        <script>
            const form = document.getElementById("auth-form");
            const toggleLink = document.getElementById("toggle-mode");
            const formTitle = document.getElementById("form-title");
            const nameGroup = document.getElementById("name-group");
            const birthdayGroup = document.getElementById("birthday-group");
            const genderGroup = document.getElementById("gender-group");
            const submitBtn = document.getElementById("submit-btn");
            const messageDiv = document.getElementById("auth-message");

            let isSignup = false;

            toggleLink.addEventListener("click", (e) => {
                e.preventDefault();
                isSignup = !isSignup;
                if (isSignup) {
                    formTitle.textContent = "Sign Up";
                    submitBtn.textContent = "Sign Up";
                    toggleLink.textContent = "Already have an account? Login";
                    nameGroup.style.display = "block";
                    birthdayGroup.style.display = "block";
                    genderGroup.style.display = "block";
                } else {
                    formTitle.textContent = "Login";
                    submitBtn.textContent = "Login";
                    toggleLink.textContent = "Don't have an account? Sign Up";
                    nameGroup.style.display = "none";
                    birthdayGroup.style.display = "none";
                    genderGroup.style.display = "none";
                }
            });

            form.addEventListener("submit", async (e) => {
                e.preventDefault();
                messageDiv.textContent = "";

                const email = document.getElementById("email").value;
                const password = document.getElementById("password").value;

                try {
                    let res;
                    if (isSignup) {
                        const name = document.getElementById("name").value;
                        const birthday =
                            document.getElementById("birthday").value;
                        const gender = document.getElementById("gender").value;
                        res = await api.post("/access/register", {
                            name,
                            email,
                            password,
                            birthday,
                            gender,
                        });
                    } else {
                        res = await api.post("/access/login", {
                            email,
                            password,
                        });
                    }

                    if (res.code === 201 || res.code === 200) {
                        const { accessToken, user } = res.metadata;
                        auth.setToken(accessToken, user._id, user);
                        window.location.href = "home.html";
                    } else {
                        messageDiv.textContent =
                            res.message || "Authentication failed";
                    }
                } catch (err) {
                    console.error(err);
                    messageDiv.textContent =
                        "An error occurred. Check console.";
                }
            });
        </script>
    </body>
</html>
